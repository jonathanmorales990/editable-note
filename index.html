<!DOCTYPE html>
	<html lang="pt-br">
	<script type="text/javascript">
		document.addEventListener("DOMContentLoaded", (event) => {
			let editableNote = {
				element: document.getElementById('editable-note'),
				container: null,
				paragraph: 0,
				toolbar: [
					'bold',
					'underline',
					'italic',
					'font-size',
					'font-color',
					'background-font-color'
				],
				fontSizes: ['8','9','10','11','12','14','16','18','24','30','36','40','48']
			}
			editableNote.initialize = function () {
				this.insertContainer();
				this.element.contentEditable = 'true';
				this.element.addEventListener('keydown', this.onChangeText, false);
				this.setStyle(400, 200);
				for(let key in this.toolbar) {
			    	this.insertButton(this.toolbar[key]);
			  	}
				this.insertParagraph();
			}
			/*editableNote.onSelectText = function (event) {
				console.log( window.getSelection() );
			}*/
			editableNote.onChangeText = function (event) {
				if(event.keyCode == 8 || event.keyCode ==  46)
					if(this.textContent.length == 0)
						if(this.childNodes.length <= 1)
							event.preventDefault();
			}
			editableNote.insertParagraph = function () {
				this.insertNode('p','class','paragraph');
			}
			editableNote.insertContainer = function () {
				let parent = this.element.parentNode;
				let wrapper = document.createElement('div');
				let attr = document.createAttribute('id');
				attr.value = 'editable-note-container';
				wrapper.setAttributeNode(attr);
				parent.replaceChild(wrapper, this.element);
				wrapper.appendChild(this.element);
				this.container = document.getElementById('editable-note-container');
			}
			editableNote.insertNode = function (elementType, attributeName = '', attributeValue = '') {
				let node = document.createElement(elementType);
				let attr = document.createAttribute(attributeName);
				attr.value = attributeValue;
				node.setAttributeNode(attr);
				this.element.appendChild(node);
			}
			editableNote.setEventFontSize = function (event) {
    			document.execCommand("fontSize", false, "7");
			    var fontElements = document.getElementsByTagName("font");
			    for (var i = 0, len = fontElements.length; i < len; ++i) {
			        if (fontElements[i].size == "7") {
			            fontElements[i].removeAttribute("size");
			            fontElements[i].style.fontSize = event.target.textContent+'px';
			        }
			    }
				event.stopPropagation();
			}
			editableNote.insertButton = function (elementType) {
				let node = document.createElement('button');
				let label = document.createElement('label');
				let input = document.createElement('input');
				let icon = document.createElement('i');
				let dropdown = document.createElement('div');
				let fontSizeList = document.createElement('span');
				let attr;

				switch (elementType) {
					case 'underline':
						attr = document.createAttribute('class');
						attr.value = 'editable-note-button fa fa-'+elementType;
						node.setAttributeNode(attr);
						node.addEventListener('click', this.setEventType, false);
						node.eventType = 'underline';
						break;
					case 'bold':
						attr = document.createAttribute('class');
						attr.value = 'editable-note-button fa fa-'+elementType;
						node.setAttributeNode(attr);
						node.addEventListener('click', this.setEventType, false);
						node.eventType = 'bold';
						break;
					case 'italic':
						attr = document.createAttribute('class');
						attr.value = 'editable-note-button fa fa-'+elementType;
						node.setAttributeNode(attr);
						node.addEventListener('click', this.setEventType, false);
						node.eventType = 'italic';
						break;
					case 'font-size':
						attr = document.createAttribute('class');
						attr.value = 'editable-note-button fa';
						node.setAttributeNode(attr);
						label.style.width = '100%';
						label.style.height = '100%';
						label.style.position = 'relative';
						attr = document.createAttribute('class');
						attr.value = 'fa fa-font';
						icon.setAttributeNode(attr);
						label.appendChild(icon);
						iconClone = icon.cloneNode(true);
						iconClone.style.fontSize = '12px';
						attr = document.createAttribute('class');
						attr.value = 'dropdown-font-size';
						dropdown.setAttributeNode(attr);
						for(let key in this.fontSizes) {
							fontSizeList.textContent = this.fontSizes[key];
							dropdown.appendChild(fontSizeList.cloneNode(true));
						}
						label.appendChild(dropdown);
						label.appendChild(iconClone);
						node.appendChild(label);
						dropdown.addEventListener('click', this.setEventFontSize, false);
						node.addEventListener('click', this.toggleDropdown, false);
						node.addEventListener('focusout', this.focusOutDropdown, false);
						break;
					case 'font-color':
						attr = document.createAttribute('class');
						attr.value = 'editable-note-button fa';
						node.setAttributeNode(attr);
						label.style.width = '100%';
						label.style.height = '100%';
						input.style.display = 'none';
						attr = document.createAttribute('class');
						attr.value = 'fa fa-font';
						icon.setAttributeNode(attr);
						attr = document.createAttribute('type');
						attr.value = 'color';
						input.setAttributeNode(attr);
						label.appendChild(icon);
						label.appendChild(input);
						node.appendChild(label);
						input.addEventListener('change', this.setEventType, false);
						input.eventType = 'foreColor';
						break;
					case 'background-font-color':
						attr = document.createAttribute('class');
						attr.value = 'editable-note-button fa';
						node.setAttributeNode(attr);
						label.style.width = '100%';
						label.style.height = '100%';
						label.style.backgroundColor = 'white';
						input.style.display = 'none';
						attr = document.createAttribute('class');
						attr.value = 'fa fa-font';
						icon.setAttributeNode(attr);
						attr = document.createAttribute('type');
						attr.value = 'color';
						input.setAttributeNode(attr);
						label.appendChild(icon);
						label.appendChild(input);
						node.appendChild(label);
						input.addEventListener('change', this.setEventType, false);
						input.eventType = 'hiliteColor';
						break;
				}
				this.container.insertBefore(node, this.element);
			}
			editableNote.setStyle = function (width, height) {
				this.element.style.width = width[length-1] == '%' ? (width+'%') : (width+'px');
				this.element.style.height = height[length-1] == '%' ? (height+'%') : (height+'px');
				this.element.style.padding = 5+"px";
				this.element.style.marginTop = 5+"px";
			}
			editableNote.setEventType = function (event) {
				event.target.eventType == 'foreColor' || event.target.eventType == 'hiliteColor' ?
					document.execCommand(event.target.eventType, false, event.target.value) :
					document.execCommand(event.target.eventType)
			}
			editableNote.toggleDropdown = function () {
				let el = document.getElementsByClassName('dropdown-font-size');
				el[0].classList[1] ? 
					setAttributes(el[0], {'class': 'dropdown-font-size'}) : setAttributes(el[0], {'class': 'dropdown-font-size open'})
			}
			editableNote.focusOutDropdown = function () {
				let el = document.getElementsByClassName('dropdown-font-size');
				setAttributes(el[0], {'class': 'dropdown-font-size'})
			}
			function setAttributes(el, attrs) {
				for(let key in attrs) {
					el.setAttribute(key, attrs[key]);
				}
			}
			function pasteHtmlAtCaret(html, selectPastedContent) {
			    let sel, range;
			    if (window.getSelection) {
			        // IE9 and non-IE
			        sel = window.getSelection();
			        if (sel.getRangeAt && sel.rangeCount) {
			            range = sel.getRangeAt(0);
			            range.deleteContents();
			            // Range.createContextualFragment() would be useful here but is
			            // only relatively recently standardized and is not supported in
			            // some browsers (IE9, for one)
			            let el = document.createElement("div");
			            el.innerHTML = html;
			            let frag = document.createDocumentFragment(), node, lastNode;
			            while ( (node = el.firstChild) ) {
			                lastNode = frag.appendChild(node);
			            }
			            let firstNode = frag.firstChild;
			            range.insertNode(frag);        
			            // Preserve the selection
			            if (lastNode) {
			                range = range.cloneRange();
			                range.setStartAfter(lastNode);
			                if (selectPastedContent) {
			                    range.setStartBefore(firstNode);
			                } else {
			                    range.collapse(true);
			                }
			                sel.removeAllRanges();
			                sel.addRange(range);
			            }
			        }
			    } else if ( (sel = document.selection) && sel.type != "Control") {
			        // IE < 9
			        let originalRange = sel.createRange();
			        originalRange.collapse(true);
			        sel.createRange().pasteHTML(html);
			        if (selectPastedContent) {
			            range = sel.createRange();
			            range.setEndPoint("StartToStart", originalRange);
			            range.select();
			        }
			    }
			}
			function getSelectionHtml() {
			    var html = "";
			    if (typeof window.getSelection != "undefined") {
			        var sel = window.getSelection();
			        if (sel.rangeCount) {
			            var container = document.createElement("div");
			            for (var i = 0, len = sel.rangeCount; i < len; ++i) {
			                container.appendChild(sel.getRangeAt(i).cloneContents());
			            }
			            html = container.innerHTML;
			        }
			    } else if (typeof document.selection != "undefined") {
			        if (document.selection.type == "Text") {
			            html = document.selection.createRange().htmlText;
			        }
			    }
			    return html;
			}
			editableNote.initialize();
		});
	</script>
	<style>
		body {
			background-color: grey;
		}
		.dropdown-font-size {
			width: 50px;
			height: 100px;
			position: absolute;
			top: 20px;
			display: none;
			border-bottom-left-radius: 3px;
			border-top-left-radius: 3px;
			left: -5px;
			box-shadow: 1px 1px 4px -1px black;
			background-color: white;
			overflow-y: scroll;
		}
		.dropdown-font-size.open {
			display: block;
		}
		.dropdown-font-size > span {
			display: block;
		}
		#editable-note {
			word-wrap: break-word;
			overflow-wrap: break-word;
   			white-space: normal;
			min-width: 400px;
			min-height: 200px;
			overflow: hidden;
			background-color: white;
		}
		#editable-note > p {
			width: 100%;
			min-height: 20px;
			margin: 0;
		}
	</style>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<title>Editable Note</title>
	</head>
	<body>
		<div id="editable-note"></div>
		<div contenteditable="true">s</div>
	</body>
</hmtl>

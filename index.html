<!DOCTYPE html>
	<html lang="pt-br">
	<script type="text/javascript">
		document.addEventListener("DOMContentLoaded", (event) => {
			let editableNote = {
				element: document.getElementById('editable-note'),
				container: null,
				paragraph: 0
			}
			editableNote.initialize = function () {
				this.insertContainer();
				this.element.contentEditable = 'true';
				this.element.addEventListener('keydown', this.onChangeText, false);
				this.setStyle(400, 200);
				this.insertButton('bold');
				this.insertButton('underline');
				this.insertButton('italic');
				this.insertButton('font-color');
				this.insertParagraph();
			}
			/*editableNote.onSelectText = function (event) {
				console.log( window.getSelection() );
			}*/
			editableNote.onChangeText = function (event) {
				if(event.keyCode == 8 || event.keyCode ==  46)
					if(this.textContent.length == 0)
						if(this.childNodes.length <= 1)
							event.preventDefault();
			}
			editableNote.insertParagraph = function () {
				this.insertNode('p','class','paragraph');
			}
			editableNote.insertContainer = function () {
				let parent = this.element.parentNode;
				let wrapper = document.createElement('div');
				let attr = document.createAttribute('id');
				attr.value = 'editable-note-container';
				wrapper.setAttributeNode(attr);
				parent.replaceChild(wrapper, this.element);
				wrapper.appendChild(this.element);
				this.container = document.getElementById('editable-note-container');
			}
			editableNote.setEventFontSize = function () {
				/*let node = document.createElement('input');
				let attrs = {
					"class": "editable-note-font-size", 
					"type": "number",
					"min": 6,
					"max": 50,
					"value": 6
				};
				setAttributes(node, attrs);
				this.container.insertBefore(node, this.element);*/
			}
			editableNote.insertNode = function (elementType, attributeName = '', attributeValue = '') {
				let node = document.createElement(elementType);
				let attr = document.createAttribute(attributeName);
				attr.value = attributeValue;
				node.setAttributeNode(attr);
				this.element.appendChild(node);
			}
			editableNote.insertButton = function (elementType) {
				let node = document.createElement('button');
				let attr;
				switch (elementType) {
					case 'underline':
						attr = document.createAttribute('class');
						attr.value = 'editable-note-button fa fa-'+elementType;
						node.setAttributeNode(attr);
						node.addEventListener('click', this.setEventType, false);
						node.eventType = 'underline';
						this.container.insertBefore(node, this.element);
						break;
					case 'bold':
						attr = document.createAttribute('class');
						attr.value = 'editable-note-button fa fa-'+elementType;
						node.setAttributeNode(attr);
						node.addEventListener('click', this.setEventType, false);
						node.eventType = 'bold';
						this.container.insertBefore(node, this.element);
						break;
					case 'italic':
						attr = document.createAttribute('class');
						attr.value = 'editable-note-button fa fa-'+elementType;
						node.setAttributeNode(attr);
						node.addEventListener('click', this.setEventType, false);
						node.eventType = 'italic';
						this.container.insertBefore(node, this.element);
						break;
					case 'font-color':
						attr = document.createAttribute('class');
						attr.value = 'editable-note-button';
						node.setAttributeNode(attr);

						let labelColor = document.createElement('label');
						let inputColor = document.createElement('input');
						let icon = document.createElement('i');

						labelColor.style.width = '100%';
						labelColor.style.height = '100%';
						inputColor.style.display = 'none';
						attr = document.createAttribute('class');
						attr.value = 'fa fa-font';
						icon.setAttributeNode(attr);
						
						attr = document.createAttribute('type');
						attr.value = 'color';
						inputColor.setAttributeNode(attr);
						
						labelColor.appendChild(icon);
						labelColor.appendChild(inputColor);

						node.appendChild(labelColor);
						this.container.insertBefore(node, this.element);
						break;
				}
			}
			editableNote.setStyle = function (width, height) {
				this.element.style.width = width[length-1] == '%' ? (width+'%') : (width+'px');
				this.element.style.height = height[length-1] == '%' ? (height+'%') : (height+'px');
				this.element.style.padding = 5+"px";
				this.element.style.marginTop = 5+"px";
			}
			editableNote.setEventType = function (event) {
				console.log(event.target.eventType);
				document.execCommand(event.target.eventType);
			}
			function setAttributes(el, attrs) {
			  for(var key in attrs) {
			    el.setAttribute(key, attrs[key]);
			  }
			}
			editableNote.initialize();
		});
	</script>
	<style>
		body {
			background-color: grey;
		}
		#editable-note {
			word-wrap: break-word;
    		overflow-wrap: break-word;
   			white-space: normal;
			min-width: 400px;
			min-height: 200px;
			overflow: hidden;
			background-color: white;
		}
		#editable-note > p {
			width: 100%;
			min-height: 20px;
			margin: 0;
		}
	</style>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<title>Editable Note</title>
	</head>
	<body>
		<label for="file-upload" class="custom-file-upload">
		    <i class="fa fa-cloud-upload"></i>
		</label>
		<input id="file-upload" type="file"/>
		<div id="editable-note"></div>
	</body>
</hmtl>
